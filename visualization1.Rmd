---
title: "Visualization 1"
author: "ak5357"
date: "2024-09-26"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggridges)
library(ggridges)
```


## Import data

```{r}
weather_df = 
  rnoaa::meteo_pull_monitors(
    c("USW00094728", "USW00022534", "USS0023B17S"),
    var = c("PRCP", "TMIN", "TMAX"), 
    date_min = "2021-01-01",
    date_max = "2022-12-31") |>
  mutate(
    name = case_match(
      id, 
      "USW00094728" ~ "CentralPark_NY", 
      "USW00022534" ~ "Molokai_HI",
      "USS0023B17S" ~ "Waterhole_WA"),
    tmin = tmin / 10,
    tmax = tmax / 10) |>
  select(name, id, everything())


weather_df
```

## Making our first plot :-)

```{r}
ggplot(weather_df, aes(x = tmin, y = tmax)) +
  geom_point()
```


```{r}
weather_df |> 
  ggplot(aes(x = tmin, y = tmax)) +
  geom_point()
```


```{r}
ggp_weather_scatterplot = 
  weather_df |> 
  ggplot(aes(x = tmin, y = tmax)) +
  geom_point()

ggp_weather_scatterplot
```


Check why some rows are missing.

```{r}
weather_df |> 
  filter(is.na(tmax))
```


## Fancier scatterplots!

```{r}
weather_df |> 
  ggplot(aes(x = tmin, y = tmax, color = name)) + #can color by some variable
  geom_point(alpha = .3, size = .8) + #alpha makes transparent
  geom_smooth(se = FALSE) #gives a smooth curve through the scatterplot points, se = standard error bars
```

All parameters in the initial `ggplot` applies to all following lines. So when `color = name` is in the `geom_point`, then `geom_smooth` doesn't treat the three colors as different sets, but rather creates one curve for the entire dataset.
```{r}
weather_df |> 
  ggplot(aes(x = tmin, y = tmax)) +
  geom_point(aes(color = name), alpha = .3, size = .8) +
  geom_smooth(se = FALSE)
```

## Using faceting

```{r}
weather_df |> 
  ggplot(aes(x = tmin, y = tmax, color = name)) +
  geom_point(alpha = 0.3, size = 0.8) +
  geom_smooth(se = FALSE) +
  facet_grid(. ~ name) #the '.' means 'everything'
```


## Other tools

Let's make a somewhat more interesting scatterplot.

```{r}
weather_df |> 
  ggplot(aes(x = date, y = tmax, color = name, size = prcp)) +
  geom_point(alpha = 0.3) +
  geom_smooth(se = FALSE, color = 'black', size = 0.7) +
  facet_grid(. ~ name)

```

## Learning assessment

```{r}
weather_df |> 
  filter(name == "CentralPark_NY") |> 
  mutate(
    tmax_fahr = (tmax * 1.8) + 32,
    tmin_fahr = (tmin * 1.8) + 32
  ) |> 
  ggplot(aes(x = tmin_fahr, y = tmax_fahr)) +
  geom_point(alpha = 0.3, color = 'cornflowerblue') +
  geom_smooth(method = "lm", se = FALSE, color = 'darkblue')

```


## Small things

Can plot just the linear model, if I exclude the `geom_point` line.

```{r}
weather_df |> 
  filter(name == "CentralPark_NY") |> 
  mutate(
    tmax_fahr = (tmax * 1.8) + 32,
    tmin_fahr = (tmin * 1.8) + 32
  ) |> 
  ggplot(aes(x = tmin_fahr, y = tmax_fahr)) +
  geom_smooth(method = "lm", se = FALSE, color = 'darkblue')
```

Hex plot, showing data density.

```{r}
weather_df |> 
  ggplot(aes(x = tmin, y = tmax)) +
  geom_hex()
```


## More tips.

This one makes the scatterplot points blue.
```{r}
weather_df |> 
  ggplot(aes(x = tmin, y = tmax)) +
  geom_point(color = 'blue')
```

This one doesn't make the scatterplot points blue. Instead, ggplot is trying to create some new variable, "blue", and color the points by that variable. So the points end up being a different color.
```{r}
weather_df |> 
  ggplot(aes(x = tmin, y = tmax, color = 'blue')) +
  geom_point()
```

## Univariate plots

Basic histogram.
```{r}
weather_df |> 
  ggplot(aes(x = tmin)) +
  geom_histogram()
```


Where bars of each variable type, are stacked.
```{r}
weather_df |> 
  ggplot(aes(x = tmin, fill = name)) +
  geom_histogram(color = 'black')
```

Where bars of each variable type, are next to each other.
```{r}
weather_df |> 
  ggplot(aes(x = tmin, fill = name)) +
  geom_histogram(position = "dodge")
```

Facet grids.
```{r}
weather_df |> 
  ggplot(aes(x = tmin, fill = name)) +
  geom_histogram(color = 'black') +
  facet_grid(. ~ name)
```

Density plot
```{r}
weather_df |> 
  ggplot(aes(x = tmin, fill = name)) +
  geom_density(alpha = 0.3)
```


Boxplot
```{r}
weather_df |> 
  ggplot(aes(x = name, y = tmin, fill = name)) +
  geom_boxplot()
```


Violin plot
```{r}
weather_df |> 
  ggplot(aes(x = name, y = tmin, fill = name)) +
  geom_violin()
```


Combined boxplot and violin plot
```{r}
weather_df |> 
  ggplot(aes(x = name, y = tmin, fill = name)) +
  geom_boxplot() +
  geom_violin(alpha = 0.3)
```

Ridge plot
(Must do `library(ggridges)` first, as this is not included with base ggplot library)
```{r}
weather_df |> 
  ggplot(aes(x = tmin, y = name)) +
  geom_density_ridges()
```


## Saving and embedding plots

Saving plots.
* Make sure to define the plot as a variable, to avoid cconfusing with saving. The `ggsave()` function just saves whichever plot was most recently created.
```{r}
ggp_weather = weather_df |> 
  ggplot(aes(x = tmin, y = tmax, color = name)) +
  geom_point(alpha = 0.3, size = 0.8) +
  geom_smooth(se = FALSE) +
  facet_grid(. ~ name) #the '.' means 'everything'

ggp_weather

ggsave("plots/ggp_weather.pdf", ggp_weather, width = 8, height = 6)
```


Embedding plots.
```{r, fig.width=6, fig.height=8}
weather_df |> 
  ggplot(aes(x = tmin, y = tmax, color = name)) +
  geom_point(alpha = 0.3, size = 0.8) +
  geom_smooth(se = FALSE) +
  facet_grid(. ~ name) #the '.' means 'everything'

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

```


